databaseChangeLog:
  - changeSet:
      id: 1
      author: bank-app
      changes:
        - createTable:
            tableName: users
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true}}
              - column: {name: username, type: VARCHAR(50), constraints: {unique: true, nullable: false}}
              - column: {name: email, type: VARCHAR(100), constraints: {unique: true, nullable: false}}
              - column: {name: password, type: VARCHAR(255), constraints: {nullable: false}}
              - column: {name: first_name, type: VARCHAR(50)}
              - column: {name: last_name, type: VARCHAR(50)}
              - column: {name: active, type: BOOLEAN, defaultValue: true}
              - column: {name: created_at, type: TIMESTAMP}
              - column: {name: updated_at, type: TIMESTAMP}
  
  - changeSet:
      id: 2
      author: bank-app
      changes:
        - createTable:
            tableName: roles
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true}}
              - column: {name: name, type: VARCHAR(20), constraints: {unique: true, nullable: false}}
  
  - changeSet:
      id: 3
      author: bank-app
      changes:
        - createTable:
            tableName: user_roles
            columns:
              - column: {name: user_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: role_id, type: BIGINT, constraints: {nullable: false}}
        - addPrimaryKey:
            constraintName: pk_user_roles
            tableName: user_roles
            columnNames: user_id, role_id
        - addForeignKeyConstraint:
            baseTableName: user_roles
            baseColumnNames: user_id
            constraintName: fk_user_roles_user
            referencedTableName: users
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: user_roles
            baseColumnNames: role_id
            constraintName: fk_user_roles_role
            referencedTableName: roles
            referencedColumnNames: id
  
  - changeSet:
      id: 4
      author: bank-app
      changes:
        - createTable:
            tableName: cards
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true}}
              - column: {name: card_number, type: VARCHAR(255), constraints: {unique: true, nullable: false}}
              - column: {name: card_holder, type: VARCHAR(100), constraints: {nullable: false}}
              - column: {name: expiry_date, type: DATE, constraints: {nullable: false}}
              - column: {name: status, type: VARCHAR(20), constraints: {nullable: false}}
              - column: {name: balance, type: DECIMAL(15,2), defaultValue: "0.00"}
              - column: {name: cvv, type: VARCHAR(255), constraints: {nullable: false}}
              - column: {name: user_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: created_at, type: TIMESTAMP}
              - column: {name: updated_at, type: TIMESTAMP}
        - addForeignKeyConstraint:
            baseTableName: cards
            baseColumnNames: user_id
            constraintName: fk_cards_user
            referencedTableName: users
            referencedColumnNames: id
  
  - changeSet:
      id: 5
      author: bank-app
      changes:
        - createTable:
            tableName: transactions
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true}}
              - column: {name: from_card_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: to_card_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: amount, type: DECIMAL(15,2), constraints: {nullable: false}}
              - column: {name: status, type: VARCHAR(20), constraints: {nullable: false}}
              - column: {name: description, type: VARCHAR(255)}
              - column: {name: transaction_date, type: TIMESTAMP}
        - addForeignKeyConstraint:
            baseTableName: transactions
            baseColumnNames: from_card_id
            constraintName: fk_transactions_from_card
            referencedTableName: cards
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: transactions
            baseColumnNames: to_card_id
            constraintName: fk_transactions_to_card
            referencedTableName: cards
            referencedColumnNames: id
  
  - changeSet:
      id: 6
      author: bank-app
      changes:
        - insert:
            tableName: roles
            columns:
              - column: {name: name, value: ROLE_USER}
        - insert:
            tableName: roles
            columns:
              - column: {name: name, value: ROLE_ADMIN}